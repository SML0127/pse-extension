{"version":3,"file":"connection-mastery-plugin.min.js","sources":["../src/utils.ts","../src/features/pick-connection.ts","../src/index.ts","../src/features/create-and-connect.ts"],"sourcesContent":["export function holdKey(keyCode: string) {\n    let holding = false;\n\n    const keydown = (e: KeyboardEvent) => {\n        if(e.code === keyCode) holding = true;\n    };\n    const keyup = (e: KeyboardEvent) => {\n        if(e.code === keyCode) holding = false;\n    };\n\n    document.addEventListener('keydown', keydown);\n    document.addEventListener('keyup', keyup);\n\n    return {\n        get holding() {\n            return holding;\n        },\n        destroy() {\n            document.removeEventListener('keydown', keydown);\n            document.removeEventListener('keydown', keyup);\n        }\n    }\n}","import { NodeEditor } from \"rete\";\nimport { holdKey } from \"../utils\";\n\nconst style = 'fill: none; stroke-width: 15px; stroke: transparent;';\n\nexport default function (editor: NodeEditor, keyCode: string) {\n    const holder = holdKey(keyCode);\n\n    editor.on('renderconnection', ({ el, connection }) => {\n        const mainPath = el.querySelector('path');\n        const path = document.createElementNS('http://www.w3.org/2000/svg','path');\n\n        path.setAttribute('style', style)\n        path.setAttribute('id', 'pick')\n\n        path.addEventListener('click', () => holder.holding && editor.removeConnection(connection));\n\n        if(mainPath && mainPath.parentElement) {\n            path.setAttribute('d', mainPath.getAttribute('d') || '');\n            mainPath.parentElement.appendChild(path);\n        }\n    });\n\n    editor.on('updateconnection', ({ el }) => {\n        const mainPath = el.querySelector('path');\n        const path = el.querySelector('#pick');\n\n        if(mainPath && path) path.setAttribute('d', mainPath.getAttribute('d') || '');\n    });\n}","import { NodeEditor } from 'rete';\nimport initializeCreateAndConnect from './features/create-and-connect';\nimport initializePickConnection from './features/pick-connection';\n\ntype Params = {\n    createAndConnect?: boolean | { keyCode: string };\n    pickConnection?: boolean | { keyCode: string };\n} \n\nfunction install(editor: NodeEditor, params: Params) {\n    const createAndConnect = params.createAndConnect === false ? false : (params.createAndConnect || { keyCode: 'Control' })\n    const pickConnection = params.pickConnection === false ? false : (params.pickConnection || { keyCode: 'KeyD' })\n\n    if(typeof createAndConnect === 'object') initializeCreateAndConnect(editor, createAndConnect.keyCode);\n    if(typeof pickConnection === 'object') initializePickConnection(editor, pickConnection.keyCode);\n}\n\nexport default {\n    name: 'connection-mastery',\n    install\n}","/// <reference types=\"rete-connection-plugin\" />\nimport { NodeEditor, Input, Output } from \"rete\";\nimport { holdKey } from \"../utils\";\n\nexport default function (editor: NodeEditor, keyCode: string) {\n    const holder = holdKey(keyCode);\n    let mouseEvent: MouseEvent | null = null;\n    let targetIO: Input | Output | null = null;\n\n    editor.view.container.addEventListener('mousemove', e => {\n        mouseEvent = e;\n    });\n    editor.on('connectiondrop', io => {\n        if(!mouseEvent) throw 'Error not found';\n        if(!holder.holding) return;\n\n        targetIO = io;\n\n        editor.trigger('contextmenu', {\n            e: mouseEvent\n        })\n    });\n    editor.on('nodecreated', node => {\n        if(!holder.holding) return;\n        const io = targetIO;\n\n        if(io instanceof Output) {\n            const inputs = Array.from(node.inputs.values());\n            const compatibleInput = inputs.find(i => io.socket.compatibleWith(i.socket))\n\n            if(compatibleInput) {\n                if (!compatibleInput.multipleConnections && compatibleInput.hasConnection())\n                    editor.removeConnection(compatibleInput.connections[0]);\n                \n                if (!io.multipleConnections && io.hasConnection())\n                    editor.removeConnection(io.connections[0]);\n\n                editor.connect(io, compatibleInput)\n            }\n        } else if(io instanceof Input) {\n            const outputs = Array.from(node.outputs.values());\n            const compatibleOutput = outputs.find(o => o.socket.compatibleWith(io.socket))\n\n            if(compatibleOutput) {\n                if(!compatibleOutput.multipleConnections && compatibleOutput.hasConnection())\n                    editor.removeConnection(compatibleOutput.connections[0])\n\n                editor.connect(compatibleOutput, io)\n            }\n        }\n    });\n    editor.on('destroy', () => holder.destroy());\n}"],"names":["holdKey","keyCode","holding","keydown","e","code","keyup","document","addEventListener","destroy","removeEventListener","style","name","install","editor","params","createAndConnect","pickConnection","_typeof","holder","mouseEvent","targetIO","view","container","on","io","trigger","node","Output","compatibleInput","Array","from","inputs","values","find","i","socket","compatibleWith","multipleConnections","hasConnection","removeConnection","connections","connect","Input","compatibleOutput","outputs","o","initializeCreateAndConnect","el","connection","mainPath","querySelector","path","createElementNS","setAttribute","parentElement","getAttribute","appendChild","initializePickConnection"],"mappings":";;;;;okNAAO,SAASA,EAAQC,OAChBC,GAAU,EAERC,EAAU,SAACC,GACVA,EAAEC,OAASJ,IAASC,GAAU,IAE/BI,EAAQ,SAACF,GACRA,EAAEC,OAASJ,IAASC,GAAU,WAGrCK,SAASC,iBAAiB,UAAWL,GACrCI,SAASC,iBAAiB,QAASF,GAE5B,sBAEQJ,GAEXO,mBACIF,SAASG,oBAAoB,UAAWP,GACxCI,SAASG,oBAAoB,UAAWJ,KChBpD,IAAMK,EAAQ,6DCcC,CACXC,KAAM,qBACNC,QAVJ,SAAiBC,EAAoBC,OAC3BC,GAA+C,IAA5BD,EAAOC,mBAAsCD,EAAOC,kBAAoB,CAAEf,QAAS,YACtGgB,GAA2C,IAA1BF,EAAOE,iBAAoCF,EAAOE,gBAAkB,CAAEhB,QAAS,SAEvE,WAA5BiB,EAAOF,ICTC,SAAUF,EAAoBb,OACnCkB,EAASnB,EAAQC,GACnBmB,EAAgC,KAChCC,EAAkC,KAEtCP,EAAOQ,KAAKC,UAAUf,iBAAiB,YAAa,SAAAJ,GAChDgB,EAAahB,IAEjBU,EAAOU,GAAG,iBAAkB,SAAAC,OACpBL,EAAY,KAAM,kBAClBD,EAAOjB,UAEXmB,EAAWI,EAEXX,EAAOY,QAAQ,cAAe,CAC1BtB,EAAGgB,OAGXN,EAAOU,GAAG,cAAe,SAAAG,MACjBR,EAAOjB,aACLuB,EAAKJ,KAERI,aAAcG,SAAQ,KAEfC,EADSC,MAAMC,KAAKJ,EAAKK,OAAOC,UACPC,KAAK,SAAAC,UAAKV,EAAGW,OAAOC,eAAeF,EAAEC,UAEjEP,KACMA,EAAgBS,qBAAuBT,EAAgBU,iBACxDzB,EAAO0B,iBAAiBX,EAAgBY,YAAY,KAEnDhB,EAAGa,qBAAuBb,EAAGc,iBAC9BzB,EAAO0B,iBAAiBf,EAAGgB,YAAY,IAE3C3B,EAAO4B,QAAQjB,EAAII,SAEpB,GAAGJ,aAAckB,QAAO,KAErBC,EADUd,MAAMC,KAAKJ,EAAKkB,QAAQZ,UACPC,KAAK,SAAAY,UAAKA,EAAEV,OAAOC,eAAeZ,EAAGW,UAEnEQ,KACKA,EAAiBN,qBAAuBM,EAAiBL,iBACzDzB,EAAO0B,iBAAiBI,EAAiBH,YAAY,IAEzD3B,EAAO4B,QAAQE,EAAkBnB,QAI7CX,EAAOU,GAAG,UAAW,kBAAML,EAAOV,YDtCOsC,CAA2BjC,EAAQE,EAAiBf,SAChE,WAA1BiB,EAAOD,IDTC,SAAUH,EAAoBb,OACnCkB,EAASnB,EAAQC,GAEvBa,EAAOU,GAAG,mBAAoB,gBAAGwB,IAAAA,GAAIC,IAAAA,WAC3BC,EAAWF,EAAGG,cAAc,QAC5BC,EAAO7C,SAAS8C,gBAAgB,6BAA6B,QAEnED,EAAKE,aAAa,QAAS3C,GAC3ByC,EAAKE,aAAa,KAAM,QAExBF,EAAK5C,iBAAiB,QAAS,kBAAMW,EAAOjB,SAAWY,EAAO0B,iBAAiBS,KAE5EC,GAAYA,EAASK,gBACpBH,EAAKE,aAAa,IAAKJ,EAASM,aAAa,MAAQ,IACrDN,EAASK,cAAcE,YAAYL,MAI3CtC,EAAOU,GAAG,mBAAoB,gBAAGwB,IAAAA,GACvBE,EAAWF,EAAGG,cAAc,QAC5BC,EAAOJ,EAAGG,cAAc,SAE3BD,GAAYE,GAAMA,EAAKE,aAAa,IAAKJ,EAASM,aAAa,MAAQ,MCbvCE,CAAyB5C,EAAQG,EAAehB"}