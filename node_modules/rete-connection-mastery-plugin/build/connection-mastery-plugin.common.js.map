{"version":3,"file":"connection-mastery-plugin.common.js","sources":["../src/utils.ts","../src/features/create-and-connect.ts","../src/features/pick-connection.ts","../src/index.ts"],"sourcesContent":["export function holdKey(keyCode: string) {\n    let holding = false;\n\n    const keydown = (e: KeyboardEvent) => {\n        if(e.code === keyCode) holding = true;\n    };\n    const keyup = (e: KeyboardEvent) => {\n        if(e.code === keyCode) holding = false;\n    };\n\n    document.addEventListener('keydown', keydown);\n    document.addEventListener('keyup', keyup);\n\n    return {\n        get holding() {\n            return holding;\n        },\n        destroy() {\n            document.removeEventListener('keydown', keydown);\n            document.removeEventListener('keydown', keyup);\n        }\n    }\n}","/// <reference types=\"rete-connection-plugin\" />\nimport { NodeEditor, Input, Output } from \"rete\";\nimport { holdKey } from \"../utils\";\n\nexport default function (editor: NodeEditor, keyCode: string) {\n    const holder = holdKey(keyCode);\n    let mouseEvent: MouseEvent | null = null;\n    let targetIO: Input | Output | null = null;\n\n    editor.view.container.addEventListener('mousemove', e => {\n        mouseEvent = e;\n    });\n    editor.on('connectiondrop', io => {\n        if(!mouseEvent) throw 'Error not found';\n        if(!holder.holding) return;\n\n        targetIO = io;\n\n        editor.trigger('contextmenu', {\n            e: mouseEvent\n        })\n    });\n    editor.on('nodecreated', node => {\n        if(!holder.holding) return;\n        const io = targetIO;\n\n        if(io instanceof Output) {\n            const inputs = Array.from(node.inputs.values());\n            const compatibleInput = inputs.find(i => io.socket.compatibleWith(i.socket))\n\n            if(compatibleInput) {\n                if (!compatibleInput.multipleConnections && compatibleInput.hasConnection())\n                    editor.removeConnection(compatibleInput.connections[0]);\n                \n                if (!io.multipleConnections && io.hasConnection())\n                    editor.removeConnection(io.connections[0]);\n\n                editor.connect(io, compatibleInput)\n            }\n        } else if(io instanceof Input) {\n            const outputs = Array.from(node.outputs.values());\n            const compatibleOutput = outputs.find(o => o.socket.compatibleWith(io.socket))\n\n            if(compatibleOutput) {\n                if(!compatibleOutput.multipleConnections && compatibleOutput.hasConnection())\n                    editor.removeConnection(compatibleOutput.connections[0])\n\n                editor.connect(compatibleOutput, io)\n            }\n        }\n    });\n    editor.on('destroy', () => holder.destroy());\n}","import { NodeEditor } from \"rete\";\nimport { holdKey } from \"../utils\";\n\nconst style = 'fill: none; stroke-width: 15px; stroke: transparent;';\n\nexport default function (editor: NodeEditor, keyCode: string) {\n    const holder = holdKey(keyCode);\n\n    editor.on('renderconnection', ({ el, connection }) => {\n        const mainPath = el.querySelector('path');\n        const path = document.createElementNS('http://www.w3.org/2000/svg','path');\n\n        path.setAttribute('style', style)\n        path.setAttribute('id', 'pick')\n\n        path.addEventListener('click', () => holder.holding && editor.removeConnection(connection));\n\n        if(mainPath && mainPath.parentElement) {\n            path.setAttribute('d', mainPath.getAttribute('d') || '');\n            mainPath.parentElement.appendChild(path);\n        }\n    });\n\n    editor.on('updateconnection', ({ el }) => {\n        const mainPath = el.querySelector('path');\n        const path = el.querySelector('#pick');\n\n        if(mainPath && path) path.setAttribute('d', mainPath.getAttribute('d') || '');\n    });\n}","import { NodeEditor } from 'rete';\nimport initializeCreateAndConnect from './features/create-and-connect';\nimport initializePickConnection from './features/pick-connection';\n\ntype Params = {\n    createAndConnect?: boolean | { keyCode: string };\n    pickConnection?: boolean | { keyCode: string };\n} \n\nfunction install(editor: NodeEditor, params: Params) {\n    const createAndConnect = params.createAndConnect === false ? false : (params.createAndConnect || { keyCode: 'Control' })\n    const pickConnection = params.pickConnection === false ? false : (params.pickConnection || { keyCode: 'KeyD' })\n\n    if(typeof createAndConnect === 'object') initializeCreateAndConnect(editor, createAndConnect.keyCode);\n    if(typeof pickConnection === 'object') initializePickConnection(editor, pickConnection.keyCode);\n}\n\nexport default {\n    name: 'connection-mastery',\n    install\n}"],"names":["holdKey","keyCode","holding","keydown","e","code","keyup","document","addEventListener","destroy","removeEventListener","editor","holder","mouseEvent","targetIO","view","container","on","io","trigger","node","Output","inputs","Array","from","values","compatibleInput","find","i","socket","compatibleWith","multipleConnections","hasConnection","removeConnection","connections","connect","Input","outputs","compatibleOutput","o","style","el","connection","mainPath","querySelector","path","createElementNS","setAttribute","parentElement","getAttribute","appendChild","install","params","createAndConnect","pickConnection","initializeCreateAndConnect","initializePickConnection","name"],"mappings":"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"}