{"version":3,"file":"connection-path-plugin.common.js","sources":["../src/path-factory.js","../src/transformers.js","../src/types.js","../src/utils.js","../src/index.js"],"sourcesContent":["import * as d3 from 'd3-shape';\n\nexport class PathFactory {\n\n    constructor(points, curve) {\n        this.points = points;\n        this.curve = curve;\n    }\n\n    line(transformer) {\n        let points = transformer(this.points);\n\n        return d3.line()\n            .x(d => d[0])\n            .y(d => d[1])\n            .curve(this.curve)\n            (points)\n    }\n\n    getData(transformer, options) {\n        return this.line(transformer(options));\n    }\n}","export default {\n    LINEAR: () => ([x1, y1, x2, y2]) => {\n        return [[x1, y1], [x2, y2]];\n    },\n    DEFAULT: ({ vertical = false, curvature = 0.4 }) => ([x1, y1, x2, y2]) => {\n        const p1 = [x1, y1];\n        const p4 = [x2, y2];\n\n        if (vertical) {\n            [x1, y1] = [y1, x1];\n            [x2, y2] = [y2, x2];\n        }\n\n        const c1 = x1 + Math.abs(x2 - x1) * curvature;\n        const c2 = x2 - Math.abs(x2 - x1) * curvature;\n        const p2 = vertical ? [y1, c1] : [c1, y1];\n        const p3 = vertical ? [y2, c2] : [c2, y2];\n\n        return [p1, p2, p3, p4];\n    }\n}","export default {\n    DEFAULT: 'DEFAULT',\n    LINEAR: 'LINEAR'\n}","export function getAngle({ x: x1, y: y1 }, { x: x2, y: y2 }) {\n    const dx = x1 - x2;\n    const dy = y1 - y2;\n\t\n    return 180 * Math.atan2(dy, dx) / Math.PI;\n}\n\nexport function getTransformAlong(path, offset, delta = 1, needRotate = true) {\n    const length = path.getTotalLength() * delta;\n    const p1 = path.getPointAtLength(length + offset);\n    const p2 = path.getPointAtLength(length);\n    const angle = 180 + (needRotate ? getAngle(p1, p2) : 0);\n\n    return `translate(${p1.x}, ${p1.y}) rotate(${angle})`;\n}","import * as d3 from 'd3-shape';\nimport { PathFactory } from './path-factory';\nimport Transformer from './transformers';\nimport Type from './types';\nimport { getTransformAlong } from './utils';\n\nfunction install(editor, { type, transformer, arrow, curve, options = {} }) {\n    type = type || Type.DEFAULT;\n    curve = curve || d3.curveBasis;\n\n    if (transformer && typeof transformer !== 'function') throw new Error('transformer property must be a function');\n    if (!Transformer[type]) throw new Error(`transformer with type ${type} doesn't exist`);\n    \n    editor.on('connectionpath', data => {\n        const { points } = data;\n        const factory = new PathFactory(points, curve);\n\n        data.d = factory.getData(transformer || Transformer[type], options);\n    });\n\n    if (arrow) {\n        editor.on('renderconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            el.querySelector('svg').appendChild(marker);\n            marker.classList.add('marker');\n            marker.setAttribute('fill', arrow.color || 'steelblue');\n            marker.setAttribute('d', arrow.marker || 'M-5,-10 L-5,10 L20,0 z');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n\n        editor.on('updateconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = el.querySelector('.marker');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n    }\n}\nexport { getTransformAlong } from './utils';\n\nexport default {\n    install,\n    ...d3,\n    ...Type\n}"],"names":["PathFactory","points","curve","transformer","d3","x","d","y","options","line","LINEAR","x1","y1","x2","y2","DEFAULT","vertical","curvature","p1","p4","c1","Math","abs","c2","p2","p3","getAngle","dx","dy","atan2","PI","getTransformAlong","path","offset","delta","needRotate","length","getTotalLength","getPointAtLength","angle","install","editor","type","arrow","Type","Error","Transformer","on","data","factory","getData","el","querySelector","marker","document","createElementNS","appendChild","classList","add","setAttribute","color"],"mappings":"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"}